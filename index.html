<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Layered City</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SLEEP CITY">
  <meta name="theme-color" content="#000000">

  <style>
    :root {
      --window-on: #ffd800;
      --window-off: #000;
      --text: #f5f5f5;
      --popup-bg: #050509;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%;
      background: #000;
      overflow: hidden;
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", sans-serif;
      color: var(--text);
    }

    /* ê°€ë¡œëª¨ë“œ í•„ìˆ˜ */
    .rotate-warning {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      text-align: center;
    }
    @media (orientation: portrait) {
      .rotate-warning { display: flex; }
    }

    /* ì „ì²´ ë ˆì´ì•„ì›ƒ */
    .wrap {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding-top: 20px;
      gap: 18px;
    }

    /* ğŸ”¥ íŒì—…ì„ ì‘ê²Œ â€” ê°€ë¡œ width ì¤„ì„ */
    .popup {
      width: 60vw;                  /* â† ë„ˆë¹„ ì¤„ì„ */
      max-width: 720px;
      height: 50vh;
      max-height: 400px;
      background: var(--popup-bg);
      border: 2px solid #fff;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      position: relative;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }

    /* ê±´ë¬¼ ë·° */
    .city-window {
      flex: 1;
      background: #000;
      border: 1px solid #333;
      position: relative;
      overflow: hidden;
    }
    .city-layers { position: absolute; inset: 0; }

    .layer {
      position: absolute;
      display: flex;
      left: 0; right: 0;
      align-items: flex-end;
      justify-content: space-between;
    }
    .layer-back { bottom: 25%; transform: scale(0.9); opacity: 0.7; }
    .layer-mid { bottom: 12%; transform: scale(0.96); opacity: 0.85; }
    .layer-front { bottom: 0; opacity: 1; }

    /* ê±´ë¬¼ */
    .building {
      position: relative;
      padding: 4px 3px 6px;
      border: 1px solid rgba(0,0,0,0.7);
      box-shadow: 0 -2px 0 rgba(255,255,255,0.05) inset;
      image-rendering: pixelated;
      display: flex;
      flex-direction: column;
    }

    /* ì§€ë¶• */
    .roof { width: 80%; margin: 0 auto 4px; }
    .roof-flat { height: 4px; background: rgba(255,255,255,0.08); }
    .roof-tri {
      width: 0; height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 12px solid rgba(255,255,255,0.15);
    }
    .roof-step {
      height: 8px;
      background: linear-gradient(to right,
        rgba(255,255,255,0.06), rgba(0,0,0,0.7), rgba(255,255,255,0.06));
      clip-path: polygon(0 100%, 0 25%, 30% 25%, 30% 0, 60% 0, 60% 25%, 100% 25%, 100% 100%);
    }

    /* ì°½ë¬¸ */
    .windows {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: 8px;
      gap: 3px;
    }
    .window {
      background: var(--window-on);
      box-shadow: 0 0 4px rgba(255,216,0,0.6);
    }
    body.lights-off .window {
      background: var(--window-off);
      box-shadow: none;
    }

    /* ğŸ”¥ START ë²„íŠ¼: íŒì—… ë°– ì•„ë˜ì— ë‘  */
    .start-btn {
      padding: 10px 20px;
      border: 2px solid #fff;
      background: #000;
      color: #fff;
      letter-spacing: 0.12em;
      font-size: 14px;
      cursor: pointer;
      text-transform: uppercase;
    }
    .start-btn:active {
      background: #111;
      transform: translateY(1px);
    }
    .status {
      font-size: 11px;
      margin-top: -10px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="rotate-warning">ê°€ë¡œ ëª¨ë“œë¡œ ëŒë ¤ì£¼ì„¸ìš”.</div>

  <div class="wrap">
    <!-- ğŸ”³ ì¤‘ì•™ ì‘ì€ íŒì—… -->
    <div class="popup">
      <div class="city-window">
        <div class="city-layers">
          <div class="layer layer-back" data-count="12"></div>
          <div class="layer layer-mid" data-count="10"></div>
          <div class="layer layer-front" data-count="8"></div>
        </div>
      </div>
    </div>

    <!-- ğŸ”¥ íŒì—… ë°–ìœ¼ë¡œ ì™„ì „íˆ ëº€ UI -->
    <button class="start-btn" id="startBtn">START</button>
    <div class="status" id="statusLabel">LIGHT: ON</div>
  </div>

  <script>
    /* ì—¬ëŸ¬ ìƒ‰ìƒ */
    const palette = [
      "#1b1b22", "#15151b", "#221726",
      "#2b1a2c", "#181820", "#1e1b26",
      "#1a1a1a", "#14141c", "#291b23"
    ];

    function makeBuilding(layerName, i) {
      const b = document.createElement("div");
      b.className = "building";

      const heightBase = layerName === "back" ? 50 : (layerName === "mid" ? 40 : 30);
      const height = heightBase + (i * 4) % 25;
      b.style.height = height + "%";
      b.style.flex = (0.4 + (i % 4) * 0.25).toFixed(2);

      const color = palette[(i * 2 + (layerName === "front" ? 1 : 0)) % palette.length];
      b.style.background = color;

      /* ì§€ë¶• */
      const r = document.createElement("div");
      r.classList.add("roof");
      const rt = i % 3;
      if (rt === 0) r.classList.add("roof-flat");
      else if (rt === 1) r.classList.add("roof-tri");
      else r.classList.add("roof-step");
      b.appendChild(r);

      /* ì°½ë¬¸ */
      const windows = document.createElement("div");
      windows.className = "windows";
      const floors = 6 + (i % 4);
      for (let k = 0; k < floors * 2; k++) {
        const w = document.createElement("div");
        w.className = "window";

        if (Math.random() < 0.1) {
          w.style.background = "#000";
          w.style.boxShadow = "none";
        }
        windows.appendChild(w);
      }

      b.appendChild(windows);
      return b;
    }

    /* ë ˆì´ì–´ì— ëœë¤ ê±´ë¬¼ ì±„ìš°ê¸° */
    document.querySelectorAll(".layer").forEach(layer => {
      const count = Number(layer.dataset.count);
      const name =
        layer.classList.contains("layer-back") ? "back" :
        layer.classList.contains("layer-mid") ? "mid" : "front";

      for (let i = 0; i < count; i++) {
        layer.appendChild(makeBuilding(name, i));
      }
    });

    /* START: ë¶ˆ ë„ê¸° */
    const startBtn = document.getElementById("startBtn");
    const statusLabel = document.getElementById("statusLabel");
    startBtn.addEventListener("click", () => {
      document.body.classList.add("lights-off");
      startBtn.disabled = true;
      startBtn.textContent = "OFF";
      statusLabel.textContent = "LIGHT: OFF";
    });
  </script>
</body>
</html>