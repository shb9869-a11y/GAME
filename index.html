<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>SLEEEEP · Tall Grass (Static · Clean D-Pad)</title>
<meta name="theme-color" content="#000000">
<style>
  :root{
    --bg:#0a0a0c; --fg:#ffffff;
    --safe-top:env(safe-area-inset-top,0px);
    --safe-bot:env(safe-area-inset-bottom,0px);
    --safe-left:env(safe-area-inset-left,0px);
    --safe-right:env(safe-area-inset-right,0px);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:ui-serif,Georgia,"Times New Roman",serif;}
  #stage{position:relative;width:100vw;height:100svh;overflow:hidden;
    padding:var(--safe-top) var(--safe-right) var(--safe-bot) var(--safe-left);}
  #view{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    image-rendering:pixelated;image-rendering:crisp-edges;background:#0d0f11}

  /* 직각 상단 버튼 (테두리/라운드/아웃라인 없음) */
  .btn{
    position:absolute;top:14px;height:36px;padding:0 14px;display:grid;place-items:center;
    background:#15151a;color:#fff;border:none;border-radius:0;
    font:700 13px/1 ui-serif,Georgia,"Times New Roman",serif;letter-spacing:.02em;
  }
  #btnMap{left:14px}  #btnInv{right:14px}

  /* D-Pad: 배경 완전 제거(투명), 글자만 */
  .dpad{
    position:absolute;left:18px;bottom:18px;width:180px;height:180px;z-index:3;display:none;
    grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:8px;
  }
  .dpad .cell{display:grid;place-items:center;background:transparent}
  .key{
    width:100%;height:100%;background:transparent;color:#fff;border:none;border-radius:0;outline:none;
    font:800 18px/1 ui-serif,Georgia,"Times New Roman",serif; /* 보기 좋은 큰 화살표 */
    text-shadow:0 1px 0 #0007;
  }
  .key:active{transform:scale(0.96)}
  @media (pointer:coarse){ .dpad{display:grid} }

  /* ACT 버튼도 직각/미니멀 */
  #btnAct{
    position:absolute;right:18px;bottom:18px;z-index:3;width:120px;height:56px;
    display:grid;place-items:center;background:#15151a;color:#fff;border:none;border-radius:0;
    font:800 13px ui-serif,Georgia,"Times New Roman",serif;
  }

  /* 모달(빈 창만) */
  .modal{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:5;background:#0008}
  .sheet{min-width:520px;max-width:86vw;min-height:320px;max-height:72vh;overflow:auto;
    background:#121218;color:#fff;border-radius:0;padding:16px}
  .sheet h3{margin:0 0 10px;font:800 14px/1 ui-serif,Georgia,"Times New Roman",serif}
  .close{float:right;background:#15151a;color:#fff;border:none;border-radius:0;padding:6px 10px;font-weight:800}
</style>
</head>
<body>
<div id="stage">
  <canvas id="view" width="1280" height="720" aria-label="게임 화면"></canvas>

  <button id="btnMap" class="btn">MAP</button>
  <button id="btnInv" class="btn">INVENTORY</button>

  <!-- 투명 D-Pad -->
  <div id="dpad" class="dpad" aria-hidden="false">
    <div class="cell"></div><div class="cell"><button class="key" data-dir="up">↑</button></div><div class="cell"></div>
    <div class="cell"><button class="key" data-dir="left">←</button></div><div class="cell"></div><div class="cell"><button class="key" data-dir="right">→</button></div>
    <div class="cell"></div><div class="cell"><button class="key" data-dir="down">↓</button></div><div class="cell"></div>
  </div>
  <button id="btnAct">ACT</button>

  <!-- MAP / INVENTORY 빈 창 -->
  <div id="mapModal" class="modal"><div class="sheet">
    <button class="close" data-close>닫기</button><h3>MAP</h3>
    <div style="height:240px;background:#0e0e13"></div>
  </div></div>
  <div id="invModal" class="modal"><div class="sheet">
    <button class="close" data-close>닫기</button><h3>INVENTORY</h3>
    <div style="height:240px;background:#0e0e13"></div>
  </div></div>
</div>

<script>
/* ===== Canvas ===== */
const stage=document.getElementById('stage');
const cv=document.getElementById('view');
const g=cv.getContext('2d'); g.imageSmoothingEnabled=false;
function fit(){ const vw=stage.clientWidth, vh=stage.clientHeight;
  const s=Math.max(1, Math.floor(Math.min(vw/cv.width, vh/cv.height)));
  cv.style.width=(cv.width*s)+'px'; cv.style.height=(cv.height*s)+'px';
  cv.style.left='50%'; cv.style.top='50%'; cv.style.transform='translate(-50%,-50%)';
}
new ResizeObserver(fit).observe(stage); fit();

/* ===== Palette ===== */
const C={
  ground:'#121614',
  tuftDark:'#0d160f',
  tuftMid :'#213222',
  tuftHi  :'#3e5a3c',
  actor:'#f0e0bf', actorEdge:'#1a1a1a', actorHead:'#ffe8c9'
};

/* ===== World ===== */
const W=cv.width, H=cv.height;
const player={x:W*0.5, y:H*0.82, spd:2.8, trail:[], size:0.7};

/* ===== “귀여운 풀” 타일 =====
   16px 격자에 3갈래 잔디(픽셀)로 화면 전체 채움 — 정적(움직임 없음) */
const TILE=16;
function prng(n){ // 타일 좌표 기반 의사난수(고정)
  n=(n<<13) ^ n; return (1.0 - ((n*(n*n*15731+789221)+1376312589)&0x7fffffff)/1073741824.0);
}
function drawCuteGrass(){
  g.fillStyle=C.ground; g.fillRect(0,0,W,H);
  for(let y=0;y<H;y+=TILE){
    for(let x=0;x<W;x+=TILE){
      const sx=(x/TILE)|0, sy=(y/TILE)|0;
      const r=Math.abs(prng(sx*73856093 ^ sy*19349663));
      // 색상 고르기(3단계)
      g.fillStyle = r<0.33 ? C.tuftDark : (r<0.66 ? C.tuftMid : C.tuftHi);
      // 작은 잔디 도트(귀엽게 3갈래)
      const cx=x+8, cy=y+8;
      g.fillRect(cx-1, cy-3, 2, 4);      // 중앙 잎
      g.fillRect(cx-4, cy-1, 2, 3);      // 좌 잎
      g.fillRect(cx+2, cy-1, 2, 3);      // 우 잎
      // 점점이 추가
      if(r>0.7){ g.fillRect(cx-6, cy+3, 1,1); }
      if(r<0.25){ g.fillRect(cx+5, cy+2, 1,1); }
    }
  }
}

/* ===== Player (작게) ===== */
function drawPlayer(){
  const s=player.size;
  // 그림자
  g.fillStyle='rgba(0,0,0,.45)'; g.fillRect(player.x-10*s, player.y+10*s, 20*s, 4*s);
  // 몸/머리
  g.fillStyle=C.actor;     g.fillRect(player.x-10*s, player.y-16*s, 20*s, 12*s);
  g.fillStyle=C.actorHead; g.fillRect(player.x-8*s,  player.y-28*s, 16*s, 10*s);
  g.fillStyle=C.actorEdge; g.fillRect(player.x-10*s, player.y-4*s,  20*s, 2*s);
}

/* ===== Input ===== */
const keys=new Set();
addEventListener('keydown',e=>{
  const k=e.key.toLowerCase();
  if(['arrowup','arrowdown','arrowleft','arrowright','w','a','s','d','e','enter'].includes(k)) e.preventDefault();
  keys.add(k);
  if(k==='e'||k==='enter') act();
});
addEventListener('keyup',e=>keys.delete(e.key.toLowerCase()));
const dpad=document.getElementById('dpad'); const held=new Set(); const dstate={ax:0,ay:0};
function updHeld(){ let ax=0,ay=0; if(held.has('left')) ax-=1; if(held.has('right')) ax+=1; if(held.has('up')) ay-=1; if(held.has('down')) ay+=1; dstate.ax=ax; dstate.ay=ay; }
dpad.querySelectorAll('[data-dir]').forEach(btn=>{
  const dir=btn.dataset.dir;
  const down=e=>{e.preventDefault();held.add(dir);updHeld();};
  const up=e=>{e.preventDefault();held.delete(dir);updHeld();};
  btn.addEventListener('pointerdown',down,{passive:false});
  btn.addEventListener('pointerup',up,{passive:false});
  btn.addEventListener('pointercancel',up,{passive:false});
  btn.addEventListener('pointerleave',up,{passive:false});
  btn.addEventListener('touchstart',down,{passive:false});
  btn.addEventListener('touchend',up,{passive:false});
  btn.addEventListener('touchcancel',up,{passive:false});
});
document.getElementById('btnAct').onclick=()=>act();

/* ===== Modals ===== */
const mapModal=document.getElementById('mapModal');
const invModal=document.getElementById('invModal');
document.getElementById('btnMap').onclick=()=>mapModal.style.display='flex';
document.getElementById('btnInv').onclick=()=>invModal.style.display='flex';
[mapModal,invModal].forEach(m=>m.addEventListener('click',e=>{ if(e.target===m||e.target.dataset.close!=null) m.style.display='none';}));

/* ===== Loop ===== */
function act(){ /* 나중에 인터랙션 채움 */ }
function update(){
  let ax=0,ay=0;
  if(keys.has('arrowleft')||keys.has('a')) ax-=1;
  if(keys.has('arrowright')||keys.has('d')) ax+=1;
  if(keys.has('arrowup')||keys.has('w')) ay-=1;
  if(keys.has('arrowdown')||keys.has('s')) ay+=1;
  ax+=dstate.ax; ay+=dstate.ay;
  const m=Math.hypot(ax,ay)||1; ax/=m; ay/=m;

  const nx=player.x + ax*player.spd;
  const ny=player.y + ay*player.spd;
  player.x = Math.max(40, Math.min(W-40, nx));
  player.y = Math.max(H*0.48, Math.min(H-30, ny));
}
function render(){
  drawCuteGrass();
  drawPlayer();
}
function loop(){ update(); render(); requestAnimationFrame(loop); }
render(); requestAnimationFrame(loop);
</script>
</body>
</html>
