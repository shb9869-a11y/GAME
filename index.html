<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Grave Run — Spirit & Opportunity (HD)</title>
<meta name="theme-color" content="#000000">
<style>
  :root{
    --bg:#0a0812; --fg:#eae6ff;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bot: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:ui-monospace,"SF Mono",Menlo,Consolas,monospace;}
  #stage{position:relative;width:100vw;height:100svh;
    padding:var(--safe-top) var(--safe-right) var(--safe-bot) var(--safe-left);
    overflow:hidden;}
  canvas{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    image-rendering:pixelated;image-rendering:crisp-edges;touch-action:none;}
  .hud{position:absolute;left:16px;top:10px;font-size:13px;
    background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);
    padding:6px 10px;border-radius:10px;}
  .btnE{position:absolute;right:16px;bottom:16px;width:180px;height:60px;
    display:none;place-items:center;border-radius:12px;
    border:1px solid rgba(255,255,255,.22);
    background:rgba(255,255,255,.08);color:#fff;
    font:800 14px ui-monospace,monospace;}
  .dialog{position:absolute;inset:0;display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,.55);}
  .dialog .box{min-width:320px;max-width:86vw;background:#171422;color:#eee;
    border:1px solid rgba(255,255,255,.2);border-radius:14px;
    padding:18px;font:13px/1.7 ui-monospace,monospace;}
  .dialog .box h3{margin:0 0 8px;font:700 13px ui-monospace,monospace;color:#ffd4a6;}
  .choices{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;}
  .choices button{padding:8px 12px;border-radius:8px;
    border:1px solid rgba(255,255,255,.25);
    background:#2c2546;color:#fff;font:700 12px ui-monospace,monospace;}
</style>
</head>
<body>
<div id="stage">
  <div id="hud" class="hud">연결 중…</div>
  <canvas id="view" width="480" height="480"></canvas>
  <button id="btnE" class="btnE">E</button>
  <div id="dialog" class="dialog">
    <div class="box">
      <h3 id="dgTitle">기록</h3>
      <div id="dgBody">...</div>
      <div id="dgChoices" class="choices"></div>
    </div>
  </div>
</div>

<script>
const TILE=24,W=20,H=20;
const cv=document.getElementById('view');
const g=cv.getContext('2d',{alpha:false});
g.imageSmoothingEnabled=false;
const stage=document.getElementById('stage');
function fit(){
  const s=Math.floor(Math.min(stage.clientWidth/cv.width,stage.clientHeight/cv.height));
  cv.style.width=cv.width*s+'px';cv.style.height=cv.height*s+'px';
}
new ResizeObserver(fit).observe(stage);fit();

/* 간단한 지형 */
const L0=Array.from({length:H},()=>Array(W).fill(0));
for(let x=0;x<W;x++){L0[0][x]=L0[H-1][x]=1;}
for(let y=0;y<H;y++){L0[y][0]=L0[y][W-1]=1;}
for(let y=3;y<17;y+=3){L0[y][5]=L0[y][10]=L0[y][15]=1;}

const me={x:10.5,y:4.5,tint:'#ffb84d'};
const opp={x:8.5,y:8.5,tint:'#a4b6c3'};

function drawMap(){
  g.fillStyle='#1b142a';g.fillRect(0,0,cv.width,cv.height);
  for(let y=0;y<H;y++)for(let x=0;x<W;x++){
    if(L0[y][x]===1){
      g.fillStyle='#6d58a5';g.fillRect(x*TILE,y*TILE,TILE,TILE);
      g.fillStyle='rgba(0,0,0,.3)';g.fillRect(x*TILE,y*TILE+TILE-4,TILE,4);
    }
  }
}
function drawSpirit(p){
  const px=Math.round(p.x*TILE-TILE/2),py=Math.round(p.y*TILE-TILE/2);
  g.fillStyle='rgba(0,0,0,.4)';g.fillRect(px+3,py+TILE-3,TILE-6,3);
  g.fillStyle=p.tint;g.fillRect(px+5,py+8,14,6);
  g.fillStyle='#fff';g.fillRect(px+7,py+5,10,3);
  g.fillStyle='#222';g.fillRect(px+5,py+14,14,2); // wheel
  g.fillStyle='#fff';g.font='10px ui-monospace';g.fillText('Spirit',px-4,py-6);
}
function drawOpp(o){
  const px=Math.round(o.x*TILE-TILE/2),py=Math.round(o.y*TILE-TILE/2);
  g.fillStyle='rgba(0,0,0,.4)';g.fillRect(px+3,py+TILE-3,TILE-6,3);
  g.fillStyle=o.tint;g.fillRect(px+5,py+8,14,6);
  g.fillStyle='#dbe8ff';g.fillRect(px+6,py+5,12,3);
  g.fillStyle='#87baff';g.fillRect(px+10,py+6,4,2);
  g.fillStyle='#fff';g.font='10px ui-monospace';g.fillText('Opportunity',px-6,py-6);
}

function render(){
  drawMap();drawOpp(opp);drawSpirit(me);
}
render();
</script>
</body>
</html>