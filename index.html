<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>TOEM style Isometric Maze</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  *{box-sizing:border-box;margin:0;padding:0;}
  body{
    background:#000;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#fff;
  }

  .game-root{
    position:relative;
    width: 800px;
    height: 450px;
    background:#111;
    overflow:hidden;
  }

  /* 월드 전체 */
  .world{
    position:absolute;
    left:50%;
    top:55%;
    transform:translate(-50%,-50%);
    width: 520px;
    height: 320px;
    pointer-events:none;
  }

  /* 타일 레이어 */
  .tile-layer,
  .entity-layer{
    position:absolute;
    inset:0;
    pointer-events:none;
  }

  /* 바닥 타일 */
  .tile{
    position:absolute;
    width:64px;
    height:32px;
    transform-origin:center center;
    transform:translate(-50%,-50%);
  }
  .tile-base{
    position:absolute;
    left:50%;
    top:50%;
    width:100%;
    height:100%;
    transform:skewY(-26deg);
    background:#f4f4f4;
    border:2px solid #000;
  }

  /* 벽(장애물) – 바닥 위에 3D 블록 느낌 */
  .tile.wall .wall-block{
    position:absolute;
    left:50%;
    top:30%;
    width:40px;
    height:40px;
    transform:translateX(-50%) skewY(-26deg);
    background:#e0e0e0;
    border:3px solid #000;
    box-shadow:0 12px 0 #000;
  }

  /* 플레이어 캐릭터 */
  .player{
    position:absolute;
    width:32px;
    height:48px;
    transform-origin:center bottom;
  }
  .player .shadow{
    position:absolute;
    left:50%;
    bottom:0;
    width:32px;
    height:12px;
    transform:translateX(-50%);
    background:radial-gradient(ellipse at center, rgba(0,0,0,0.45) 0, transparent 70%);
  }
  .player .body{
    position:absolute;
    left:50%;
    bottom:14px;
    transform:translateX(-50%);
    width:24px;
    height:22px;
    border-radius:4px;
    background:#fff;
    border:3px solid #000;
  }
  .player .head{
    position:absolute;
    left:50%;
    bottom:34px;
    transform:translateX(-50%);
    width:18px;
    height:18px;
    border-radius:50%;
    background:#fff;
    border:3px solid #000;
  }

  /* 질문 UI */
  .dialogue-wrapper{
    position:absolute;
    left:50%;
    top:6%;
    transform:translateX(-50%);
    z-index:20;
  }
  .dialogue-box{
    background:#000;
    padding:10px 20px;
    border-radius:8px;
    border:3px solid #fff;
    box-shadow:0 4px 0 #000;
    text-transform:uppercase;
    letter-spacing:0.08em;
    font-size:18px;
  }
  .choices{
    margin-top:8px;
    display:flex;
    justify-content:center;
    gap:14px;
  }
  .choice{
    position:relative;
    padding:6px 16px;
    background:#f8f8f8;
    color:#000;
    border-radius:8px;
    border:3px solid #000;
    text-transform:uppercase;
    letter-spacing:0.06em;
    font-size:15px;
    min-width:110px;
    text-align:center;
    cursor:pointer;
  }
  .choice.selected{
    background:#000;
    color:#fff;
    box-shadow:0 0 0 3px #fff;
  }

  /* 오른쪽 화살표 (다음 씬 아이콘) */
  .next-arrow{
    position:absolute;
    right:24px;
    top:50%;
    transform:translateY(-50%);
    width:32px;
    height:32px;
    border-radius:50%;
    border:4px solid #fff;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .next-arrow::before{
    content:"";
    border-style:solid;
    border-width:6px 0 6px 11px;
    border-color:transparent transparent transparent #fff;
    margin-left:1px;
  }

  /* 좌측 하단 방향키(D-pad) */
  .dpad{
    position:absolute;
    left:20px;
    bottom:20px;
    width:120px;
    height:120px;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    grid-template-rows:repeat(3,1fr);
    gap:4px;
    z-index:30;
  }
  .dpad button{
    border:none;
    background:#222;
    color:#fff;
    border-radius:10px;
    border:3px solid #fff;
    box-shadow:0 3px 0 #000;
    font-size:16px;
    cursor:pointer;
    touch-action:manipulation;
  }
  .dpad button:active{
    transform:translateY(2px);
    box-shadow:0 1px 0 #000;
  }
  .dpad .empty{
    background:transparent;
    border:none;
    box-shadow:none;
    pointer-events:none;
  }

  .log{
    position:absolute;
    left:10px;
    top:10px;
    font-size:12px;
    color:#ccc;
    z-index:40;
  }
</style>
</head>
<body>

<div class="game-root">
  <div class="world">
    <div class="tile-layer" id="tileLayer"></div>
    <div class="entity-layer">
      <div class="player" id="player">
        <div class="shadow"></div>
        <div class="body"></div>
        <div class="head"></div>
      </div>
    </div>
  </div>

  <!-- 질문/선택 UI (그냥 샘플) -->
  <div class="dialogue-wrapper">
    <div class="dialogue-box">HOW ARE YOU FEELING?</div>
    <div class="choices">
      <div class="choice selected">EXCITED!</div>
      <div class="choice">NERVOUS</div>
    </div>
  </div>

  <div class="next-arrow"></div>

  <!-- 좌측 하단 방향키 -->
  <div class="dpad">
    <div class="empty"></div>
    <button data-dir="up">▲</button>
    <div class="empty"></div>

    <button data-dir="left">◀</button>
    <div class="empty"></div>
    <button data-dir="right">▶</button>

    <div class="empty"></div>
    <button data-dir="down">▼</button>
    <div class="empty"></div>
  </div>

  <div class="log" id="log">←↑→↓ 또는 D-pad 로 캐릭터를 움직여보세요.</div>
</div>

<script>
  /**
   * 0 = 빈칸(이동 가능)
   * 1 = 벽(이동 불가)
   * 간단한 미로 예시
   */
  const maze = [
    [1,1,1,1,1,1,1,1,1],
    [1,0,0,0,1,0,0,0,1],
    [1,0,1,0,1,0,1,0,1],
    [1,0,1,0,0,0,1,0,1],
    [1,0,1,1,1,0,1,0,1],
    [1,0,0,0,0,0,1,0,1],
    [1,1,1,1,1,0,1,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1]
  ];
  const rows = maze.length;
  const cols = maze[0].length;

  const tileLayer = document.getElementById('tileLayer');

  // 아이소메트릭 투영에 필요한 값
  const tileW = 64;
  const tileH = 32;
  const originX = 260; // 화면 중앙 부근
  const originY = 70;

  // 타일 DOM 생성
  for(let y=0; y<rows; y++){
    for(let x=0; x<cols; x++){
      const tile = document.createElement('div');
      tile.className = 'tile' + (maze[y][x] === 1 ? ' wall' : '');
      const base = document.createElement('div');
      base.className = 'tile-base';
      tile.appendChild(base);

      if(maze[y][x] === 1){
        const wall = document.createElement('div');
        wall.className = 'wall-block';
        tile.appendChild(wall);
      }

      // 아이소메트릭 좌표 -> 화면 좌표
      const isoX = (x - y) * (tileW/2);
      const isoY = (x + y) * (tileH/2);
      tile.style.left = (originX + isoX) + 'px';
      tile.style.top  = (originY + isoY) + 'px';
      tile.style.zIndex = 10 + x + y; // 아래쪽에 있는 타일이 위에 보이게

      tileLayer.appendChild(tile);
    }
  }

  // 플레이어 위치 (미로 좌표)
  let px = 1; // 시작 x
  let py = 1; // 시작 y
  const playerEl = document.getElementById('player');
  const logEl = document.getElementById('log');

  function updatePlayerPosition(){
    const isoX = (px - py) * (tileW/2);
    const isoY = (px + py) * (tileH/2);
    playerEl.style.left = (originX + isoX) + 'px';
    playerEl.style.top  = (originY + isoY) + 'px';
    playerEl.style.zIndex = 100 + px + py; // 항상 위에
  }

  updatePlayerPosition();

  function canMove(nx, ny){
    if(nx < 0 || nx >= cols || ny < 0 || ny >= rows) return false;
    return maze[ny][nx] === 0;
  }

  function move(dx, dy){
    const nx = px + dx;
    const ny = py + dy;
    if(canMove(nx, ny)){
      px = nx;
      py = ny;
      updatePlayerPosition();
      logEl.textContent = `플레이어 미로 좌표: x=${px}, y=${py}`;
    }else{
      // 벽에 부딪힌 경우
      logEl.textContent = '벽이 있어요! 다른 길을 찾아보세요.';
    }
  }

  // 키보드 이동
  window.addEventListener('keydown', e=>{
    if(e.key === 'ArrowUp'){        // 등각 기준으로 위쪽: y-1
      move(0,-1);
    }else if(e.key === 'ArrowDown'){
      move(0,1);
    }else if(e.key === 'ArrowLeft'){
      move(-1,0);
    }else if(e.key === 'ArrowRight'){
      move(1,0);
    }
  });

  // D-pad 이동 (클릭/터치)
  document.querySelectorAll('.dpad button[data-dir]').forEach(btn=>{
    const dir = btn.dataset.dir;
    btn.addEventListener('click', ()=>{
      if(dir === 'up') move(0,-1);
      if(dir === 'down') move(0,1);
      if(dir === 'left') move(-1,0);
      if(dir === 'right') move(1,0);
    });
  });
</script>
</body>
</html>