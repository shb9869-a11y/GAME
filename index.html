<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="SLEEEEP">
<meta name="theme-color" content="#000000">
<link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlNMRUVFUEQgTWF6ZSIsCiAgInNob3J0X25hbWUiOiAiU0xFRUVFUCIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAib3JpZW50YXRpb24iOiJsYW5kc2NhcGUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwMDAwMDAiLAogICJ0aGVtZV9jb2xvciI6ICIjMDAwMDAwIiwKICAiaWNvbnMiOiBbXQp9">
<title>SLEEEEP · Maze</title>
<style>
:root{ --fg:#fff; --bg:#000; --accent:#e94560; --panel-bg:#101018; }
*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; background:#000; color:var(--fg);
  font-family:ui-monospace,"SF Mono",Menlo,Consolas,monospace; overflow:hidden;
  -webkit-user-select:none; user-select:none; -webkit-touch-callout:none; }
body{ display:flex; align-items:center; justify-content:center; }
#desk{ position:relative; width:100vw; height:100vh; overflow:hidden; display:flex; align-items:center; justify-content:center; }
.gameWin{ position:relative; width:min(1080px, 92vh); aspect-ratio:16/9; background:#000;
  box-shadow:0 24px 60px rgba(0,0,0,.8), 0 0 0 1px rgba(255,255,255,.1); overflow:hidden; }
#view{ position:absolute; inset:0; width:100%; height:100%;
  image-rendering:pixelated; image-rendering:crisp-edges; background:#000; display:block; }
.scan{ position:absolute; inset:0; pointer-events:none; opacity:.14; mix-blend-mode:overlay;
  background:repeating-linear-gradient(to bottom, rgba(255,255,255,.12) 0px, rgba(255,255,255,.12) 1px, rgba(0,0,0,0) 3px, rgba(0,0,0,0) 4px); }
.controls{ position:absolute; bottom:20px; left:0; right:0; height:120px;
  display:flex; justify-content:space-between; align-items:flex-end; padding:0 30px; pointer-events:none; }
.dirpad{ display:grid; grid-template-columns:repeat(3,80px); grid-template-rows:repeat(3,80px); gap:4px; pointer-events:auto; }
.dir-btn{ background:rgba(255,255,255,.08); border:2px solid rgba(255,255,255,.25); color:#fff;
  font:800 28px ui-serif; cursor:pointer; display:flex; align-items:center; justify-content:center;
  transition:all .1s; -webkit-tap-highlight-color:transparent; }
.dir-btn:active{ background:rgba(255,255,255,.15); transform:scale(.95); }
.dir-btn:nth-child(2){ grid-column:2; grid-row:1; }
.dir-btn:nth-child(3){ grid-column:1; grid-row:2; }
.dir-btn:nth-child(4){ grid-column:2; grid-row:2; display:none; }
.dir-btn:nth-child(5){ grid-column:3; grid-row:2; }
.dir-btn:nth-child(6){ grid-column:2; grid-row:3; }
#stageInfo{ position:absolute; top:12px; left:12px; font:800 16px ui-monospace; background:rgba(0,0,0,.5); padding:8px 12px; }
#hint{ position:absolute; top:12px; left:50%; transform:translateX(-50%); font:600 14px ui-monospace; background:rgba(0,0,0,.5); padding:8px 12px; pointer-events:none; }
#clearPopup{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.95); z-index:20; }
.clearBox{ background:var(--panel-bg); border:2px solid var(--accent); padding:40px; text-align:center; min-width:320px; }
.clearBox h2{ margin:0 0 20px; font:800 24px ui-serif; color:var(--accent); }
.clearBox button{ background:transparent; border:2px solid var(--fg); color:var(--fg); padding:12px 24px; font:800 16px ui-monospace; cursor:pointer; margin:0 8px; transition:all .2s; }
.clearBox button:hover{ background:var(--fg); color:var(--bg); }
@media (max-width:768px){ .gameWin{ width:min(1080px, 90vh); } .controls{ padding:0 20px; } .dirpad{ grid-template-columns:repeat(3,70px); grid-template-rows:repeat(3,70px); } }
</style>
</head>
<body>
<div id="desk">
  <div class="gameWin" id="gameWin">
    <canvas id="view" width="960" height="540" aria-label="게임 화면"></canvas>
    <div class="scan"></div>
    
    <div id="stageInfo">STAGE 1</div>
    <div id="hint">EXIT ↑</div>
    
    <div class="controls">
      <div class="dirpad" id="dirpad">
        <div></div><button class="dir-btn" data-dir="up">↑</button><div></div>
        <button class="dir-btn" data-dir="left">←</button><div></div><button class="dir-btn" data-dir="right">→</button>
        <div></div><button class="dir-btn" data-dir="down">↓</button><div></div>
      </div>
    </div>

    <div id="clearPopup">
      <div class="clearBox">
        <h2>STAGE CLEAR!</h2>
        <p style="margin:0 0 24px; opacity:.8;">탈출 성공</p>
        <button id="nextStageBtn">NEXT ROUND</button>
        <button id="restartBtn">RESTART</button>
      </div>
    </div>
  </div>
</div>
<script>
class AudioManager{constructor(){this.SFX_ON=new URLSearchParams(location.search).get('sfx')!=='0';this.ready=false;}init(){if(!this.SFX_ON||this.ready)return;this.AC=new(window.AudioContext||window.webkitAudioContext)();this.master=this.AC.createGain();this.master.gain.value=0.35;this.master.connect(this.AC.destination);this.footGain=this.AC.createGain();this.footGain.gain.value=0;this.footGain.connect(this.master);this.rustleGain=this.AC.createGain();this.rustleGain.gain.value=0;this.rustleGain.connect(this.master);const noiseBuf=this.AC.createBuffer(1,this.AC.sampleRate*2,this.AC.sampleRate);const data=noiseBuf.getChannelData(0);for(let i=0;i<data.length;i++)data[i]=(Math.random()*2-1)*0.35;const noise=this.AC.createBufferSource();noise.buffer=noiseBuf;noise.loop=true;const bp=this.AC.createBiquadFilter();bp.type='bandpass';bp.frequency.value=2200;bp.Q.value=1.3;noise.connect(bp).connect(this.rustleGain);noise.start();this.ready=true;}async unlock(){try{this.init();if(this.AC?.state==='suspended')await this.AC.resume();}catch(e){}}footstep(){if(!this.ready)return;const t=this.AC.currentTime;const osc=this.AC.createOscillator();osc.type='triangle';const g=this.AC.createGain();g.gain.value=0;osc.frequency.setValueAtTime(120+Math.random()*25,t);g.gain.linearRampToValueAtTime(0.35,t+0.005);g.gain.exponentialRampToValueAtTime(0.001,t+0.10);osc.connect(g).connect(this.footGain);osc.start(t);osc.stop(t+0.12);this.rustleGain.gain.cancelScheduledValues(t);this.rustleGain.gain.linearRampToValueAtTime(0.22,t+0.01);this.rustleGain.gain.exponentialRampToValueAtTime(0.02,t+0.25);}}
const audio=new AudioManager();['pointerdown','touchstart','keydown'].forEach(ev=>addEventListener(ev,()=>audio.unlock(),{passive:true}));
class Maze{constructor(seed){this.TILE=24;this.W=960;this.H=540;this.COLS=(this.W/this.TILE)|0;this.ROWS=(this.H/this.TILE)|0;this.OPEN=0;this.WALL=1;this.SEED=seed;this.grid=Array.from({length:this.ROWS},()=>Array(this.COLS).fill(this.WALL));this.colors={grassD:'#0b0f0b',grassM:'#171f17',grassH:'#293329',path:'#cfd6d9',edgeTop:'#f5f9fb',edgeBot:'#4a5053',exitMark:'rgba(255,255,255,.25)',factory:'#888'};}rnd(){this.SEED=(this.SEED*1664525+1013904223)>>>0;return this.SEED/0xFFFFFFFF;}
generate(){const sx=1|1,sy=this.ROWS-2;const stack=[[sx,sy]];this.grid[sy][sx]=this.OPEN;const dirs=[[2,0],[-2,0],[0,2],[0,-2]];while(stack.length){const[x,y]=stack[stack.length-1];const cand=dirs.map(d=>[x+d[0],y+d[1]]).filter(([nx,ny])=>nx>0&&ny>0&&nx<this.COLS-1&&ny<this.ROWS-1&&this.grid[ny][nx]===this.WALL);if(!cand.length){stack.pop();continue;}const[nx,ny]=cand[(this.rnd()*cand.length)|0];this.grid[(y+ny)/2][(x+nx)/2]=this.OPEN;this.grid[ny][nx]=this.OPEN;stack.push([nx,ny]);}const exitX=this.COLS-2|1;for(let y=1;y<4;y++)this.grid[y][exitX]=this.OPEN;for(let dy=-1;dy<=1;dy++)for(let dx=-1;dx<=1;dx++)this.grid[1+dy][exitX+dx]=this.OPEN;return{start:[sx,sy],exit:[exitX,1]};}prng(n){n=(n<<13)^n;return(1-((n*(n*n*15731+789221)+1376312589)&0x7fffffff)/1073741824.0);}draw(ctx){ctx.fillStyle='#000';ctx.fillRect(0,0,this.W,this.H);for(let y=0;y<this.ROWS;y++){for(let x=0;x<this.COLS;x++){const tx=x*this.TILE;const ty=y*this.TILE;if(this.grid[y][x]===this.OPEN){ctx.fillStyle=this.colors.path;ctx.fillRect(tx,ty,this.TILE,this.TILE);ctx.fillStyle=this.colors.edgeTop;ctx.fillRect(tx,ty,this.TILE,1);ctx.fillStyle=this.colors.edgeBot;ctx.fillRect(tx,ty+this.TILE-1,this.TILE,1);}else{const r=Math.abs(this.prng(x*73856093^y*19349663));ctx.fillStyle=r<0.33?this.colors.grassD:r<0.66?this.colors.grassM:this.colors.grassH;const cx=tx+(this.TILE>>1);const cy=ty+(this.TILE>>1);ctx.fillRect(cx-1,cy-4,2,5);ctx.fillRect(cx-4,cy-1,2,3);ctx.fillRect(cx+2,cy-1,2,3);if(r>0.7)ctx.fillRect(cx-6,cy+4,1,1);if(r<0.25)ctx.fillRect(cx+5,cy+3,1,1);}}}
const ex=this.exit[0]*this.TILE;const ey=this.exit[1]*this.TILE;ctx.fillStyle=this.colors.factory;ctx.fillRect(ex-this.TILE,ey-this.TILE,this.TILE*3,this.TILE*3);ctx.fillStyle='#444';ctx.fillRect(ex-this.TILE+2,ey-this.TILE+2,this.TILE*3-4,this.TILE*3-4);ctx.fillStyle='#aaa';ctx.fillRect(ex-4,ey-4,8,8);ctx.fillStyle='#ccc';ctx.fillRect(ex-2,ey-6,4,2);ctx.fillStyle='#666';ctx.fillRect(ex-6,ey-2,2,4);ctx.fillRect(ex+4,ey-2,2,4);ctx.fillRect(ex-2,ey+4,4,2);}
isOpen(px,py){const tx=(px/this.TILE)|0;const ty=(py/this.TILE)|0;if(tx<0||ty<0||tx>=this.COLS||ty>=this.ROWS)return false;return this.grid[ty][tx]===this.OPEN;}}
class Player{constructor(start,tileSize){this.x=start[0]*tileSize+(tileSize>>1);this.y=start[1]*tileSize+(tileSize>>1);this.spd=3.5;this.size=0.9;this.lastStepX=this.x;this.lastStepY=this.y;this.stepAcc=0;this.STEP_DIST=10;this.colors={fill:'#ffffff',edge:'#111',shadow:'rgba(0,0,0,.55)'};}move(ax,ay,maze){let moved=false;const m=Math.hypot(ax,ay)||1;ax/=m;ay/=m;const nx=this.x+ax*this.spd;const ny=this.y+ay*this.spd;if(maze.isOpen(nx,this.y)){this.x=nx;moved=true;}if(maze.isOpen(this.x,ny)){this.y=ny;moved=true;}if(moved){const dx=this.x-this.lastStepX;const dy=this.y-this.lastStepY;this.stepAcc+=Math.hypot(dx,dy);if(this.stepAcc>=this.STEP_DIST){audio.footstep();this.stepAcc=0;}this.lastStepX=this.x;this.lastStepY=this.y;}}draw(ctx){const s=this.size;const px=this.x;const py=this.y;ctx.fillStyle=this.colors.shadow;ctx.fillRect(px-6*s,py+6*s,12*s,3*s);ctx.fillStyle=this.colors.fill;ctx.fillRect(px-6*s,py-10*s,12*s,10*s);ctx.fillRect(px-5*s,py-16*s,10*s,6*s);ctx.fillStyle=this.colors.edge;ctx.fillRect(px-6*s,py-10*s,12*s,1*s);ctx.fillRect(px-6*s,py-1*s,12*s,1*s);ctx.fillRect(px-6*s,py-10*s,1*s,10*s);ctx.fillRect(px+5*s,py-10*s,1*s,10*s);ctx.fillRect(px-5*s,py-16*s,10*s,1*s);ctx.fillRect(px-5*s,py-10*s,10*s,1*s);ctx.fillRect(px-5*s,py-16*s,1*s,6*s);ctx.fillRect(px+4*s,py-16*s,1*s,6*s);}}
class Game{constructor(){this.canvas=document.getElementById('view');this.ctx=this.canvas.getContext('2d',{alpha:false});this.ctx.imageSmoothingEnabled=false;this.keys=new Set();this.dstate={ax:0,ay:0};this.round=1;this.maze=new Maze(this.round*1000+2025);const{start,exit}=this.maze.generate();this.start=start;this.exit=exit;this.player=new Player(start,this.maze.TILE);this.setupControls();this.gameLoop();}
setupControls(){addEventListener('keydown',e=>{const k=e.key.toLowerCase();if(['arrowup','arrowdown','arrowleft','arrowright','w','a','s','d'].includes(k)){e.preventDefault();this.keys.add(k);}});addEventListener('keyup',e=>this.keys.delete(e.key.toLowerCase()));const held=new Set();const setHeld=(dir,on)=>{if(on)held.add(dir);else held.delete(dir);let ax=0,ay=0;if(held.has('left'))ax-=1;if(held.has('right'))ax+=1;if(held.has('up'))ay-=1;if(held.has('down'))ay+=1;this.dstate.ax=ax;this.dstate.ay=ay;};document.querySelectorAll('[data-dir]').forEach(b=>{const dir=b.dataset.dir;const off=e=>{e.preventDefault();setHeld(dir,false);};b.addEventListener('pointerdown',e=>{e.preventDefault();setHeld(dir,true);},{passive:false});b.addEventListener('pointerup',off,{passive:false});b.addEventListener('pointerleave',off,{passive:false});});document.getElementById('nextRoundBtn').onclick=()=>this.nextRound();document.getElementById('restartBtn').onclick=()=>this.restart();}
checkFactory(){const fx=this.exit[0]*this.maze.TILE+this.maze.TILE/2;const fy=this.exit[1]*this.maze.TILE+this.maze.TILE/2;const dx=this.player.x-fx;const dy=this.player.y-fy;if(Math.hypot(dx,dy)<this.maze.TILE/2)this.showClear();}showClear(){document.getElementById('clearPopup').style.display='flex';}nextRound(){this.round++;document.getElementById('roundNum').textContent=this.round;document.getElementById('clearPopup').style.display='none';this.maze=new Maze(this.round*1000+2025);const{start,exit}=this.maze.generate();this.start=start;this.exit=exit;this.player=new Player(start,this.maze.TILE);}restart(){document.getElementById('clearPopup').style.display='none';this.player=new Player(this.start,this.maze.TILE);}
update(){let ax=0,ay=0;if(this.keys.has('arrowleft')||this.keys.has('a'))ax-=1;if(this.keys.has('arrowright')||this.keys.has('d'))ax+=1;if(this.keys.has('arrowup')||this.keys.has('w'))ay-=1;if(this.keys.has('arrowdown')||this.keys.has('s'))ay+=1;ax+=this.dstate.ax;ay+=this.dstate.ay;this.player.move(ax,ay,this.maze);this.checkFactory();}render(){this.maze.draw(this.ctx);this.player.draw(this.ctx);}gameLoop(){this.update();this.render();requestAnimationFrame(()=>this.gameLoop());}}
window.addEventListener('load',()=>new Game());
</script>
</body>
</html>
