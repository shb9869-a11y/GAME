<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>SLEEEEEEEEEEP City Intro</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="SLEEEEP">
<meta name="theme-color" content="#111111">

<style>
  *{
    box-sizing:border-box;
    margin:0;
    padding:0;
  }
  html,body{
    height:100%;
  }
  body{
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:#050608;
    display:flex;
    justify-content:center;
    align-items:center;

    -webkit-user-select:none;
    user-select:none;
    -webkit-touch-callout:none;
    -webkit-tap-highlight-color:transparent;
  }

  /* 세로 모드 경고 */
  .rotate-warning{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:#000;
    color:#fff;
    text-align:center;
    padding:20px;
    z-index:1000;
    font-size:18px;
  }
  @media (orientation:portrait){
    .rotate-warning{display:flex;}
    .game-shell{display:none;}
  }

  /* ===== 팝업 게임 창 ===== */
  .game-shell{
    width:100vw;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .game-popup{
    position:relative;
    width:92vw;
    max-width:980px;
    aspect-ratio:16/9;
    background:#1e2026;
    border-radius:16px;
    box-shadow:0 0 40px rgba(0,0,0,0.9);
    overflow:hidden;
    border:4px solid #050609;
  }
  .game-root{
    position:absolute;
    inset:0;
    background:#c4cad4;
    overflow:hidden;
    image-rendering:pixelated;
  }

  /* ===== 하늘 ===== */
  .sky{
    position:absolute;
    inset:0;
    background:linear-gradient(to bottom,#e1e4ec 0 55%,#c4cad4 55% 100%);
  }

  /* ===== 시티 3 레이어 ===== */
  .city{
    position:absolute;
    left:0;
    right:0;
    bottom:42%;
    top:0;
    overflow:hidden;
  }
  .city-layer{
    position:absolute;
    left:0;
    right:0;
    bottom:0;
    top:10%;
    opacity:0.95;
    image-rendering:pixelated;
  }
  /* 뒤 회색/카키 */
  .city-far{
    background:
      repeating-linear-gradient(
        to right,
        #8c939b 0 24px,
        #8c939b 24px 48px,
        transparent 48px 56px
      ),
      repeating-linear-gradient(
        to right,
        #a4aa9f 0 28px,
        #a4aa9f 28px 56px,
        transparent 56px 66px
      );
    background-size: 210px 100%, 260px 100%;
    animation: cityScrollFar 55s linear infinite;
  }
  /* 중간 보라/파스텔 */
  .city-mid{
    background:
      repeating-linear-gradient(
        to right,
        #8682a6 0 24px,
        #8682a6 24px 48px,
        transparent 48px 56px
      ),
      repeating-linear-gradient(
        to right,
        #b7a2c4 0 28px,
        #b7a2c4 28px 56px,
        transparent 56px 66px
      );
    background-size: 190px 100%, 230px 100%;
    animation: cityScrollMid 40s linear infinite;
    mix-blend-mode:multiply;
  }
  /* 앞쪽 컬러풀 빌딩 (저채도) */
  .city-near{
    background:
      repeating-linear-gradient(
        to right,
        #5c8f72 0 24px,
        #5c8f72 24px 46px,
        transparent 46px 56px
      ),
      repeating-linear-gradient(
        to right,
        #c96f85 0 24px,
        #c96f85 24px 46px,
        transparent 46px 56px
      ),
      repeating-linear-gradient(
        to right,
        #647ea3 0 26px,
        #647ea3 26px 50px,
        transparent 50px 60px
      );
    background-size: 200px 100%, 240px 100%, 220px 100%;
    animation: cityScrollNear 28s linear infinite;
  }

  @keyframes cityScrollFar{
    0%{background-position:0 0,0 0;}
    100%{background-position:-320px 0,-260px 0;}
  }
  @keyframes cityScrollMid{
    0%{background-position:0 0,0 0;}
    100%{background-position:-260px 0,-210px 0;}
  }
  @keyframes cityScrollNear{
    0%{background-position:0 0,0 0,0 0;}
    100%{background-position:-220px 0,-280px 0,-250px 0;}
  }

  /* ===== 수풀 ===== */
  .bush-band{
    position:absolute;
    left:0;
    right:0;
    bottom:40%;
    height:11%;
    background:
      repeating-linear-gradient(
        to right,
        #1e3821 0 8px,
        #1e3821 8px 12px,
        #25532b 12px 18px,
        #2b6935 18px 24px
      );
    box-shadow:0 -4px 0 rgba(0,0,0,0.5);
  }

  /* ===== 도로 ===== */
  .road{
    position:absolute;
    left:5%;
    right:5%;
    bottom:5%;
    top:60%;
    background:#5b5d62;
    border-radius:10px;
    box-shadow:0 0 0 4px #272a31;
    overflow:hidden;
  }
  .road-edge-top,
  .road-edge-bottom{
    position:absolute;
    left:0;
    right:0;
    height:8px;
    background:
      repeating-linear-gradient(
        to right,
        #e9e9e9 0 6px,
        #e9e9e9 6px 12px,
        #464646 12px 18px
      );
  }
  .road-edge-top{top:0;}
  .road-edge-bottom{bottom:0;}

  .lane{
    position:absolute;
    left:0;
    right:0;
    height:6px;
    background:
      repeating-linear-gradient(
        to right,
        transparent 0 26px,
        #f3f3f3 26px 42px
      );
  }
  .lane.mid{ top:46%; }
  .lane.low{ top:72%; opacity:0.7; }

  /* ===== 가로등 ===== */
  .lamps{
    position:absolute;
    left:0;
    right:0;
    top:8%;
    height:32%;
    pointer-events:none;
  }
  .lamp{
    position:absolute;
    bottom:10%;
    width:6px;
    height:60%;
    background:#43454b;
    box-shadow:0 0 0 2px #2b2e32;
  }
  .lamp::before{
    content:'';
    position:absolute;
    left:50%;
    top:-18px;
    width:6px;
    height:18px;
    transform:translateX(-50%);
    background:#43454b;
  }
  .lamp::after{
    content:'';
    position:absolute;
    left:50%;
    top:-26px;
    width:18px;
    height:18px;
    transform:translateX(-50%);
    border-radius:50%;
    background:radial-gradient(circle at 30% 25%,#ffffcc 0,#f6ea9a 40%,#f4d96b 70%,#ebc850 100%);
    box-shadow:0 0 14px rgba(247,232,150,0.75);
  }

  /* ===== 자동차 ===== */
  .car{
    position:absolute;
    bottom:24%;
    width:40px;
    height:22px;
    background:#e9c35c;
    border-radius:8px 8px 4px 4px;
    border:3px solid #323232;
    box-shadow:0 3px 0 rgba(0,0,0,0.6);
    animation: carMove 6.5s linear infinite;
  }
  .car::before,
  .car::after{
    content:'';
    position:absolute;
    bottom:-7px;
    width:14px;
    height:14px;
    border-radius:50%;
    background:#111;
  }
  .car::before{ left:4px; }
  .car::after{ right:4px; }
  .car.front{
    bottom:38%;
    transform:scale(0.9);
    animation-duration:5.1s;
    animation-delay:-2.1s;
  }
  @keyframes carMove{
    0%{ transform:translateX(-60px) scale(var(--scale,1)); }
    100%{ transform:translateX(110%) scale(var(--scale,1)); }
  }

  /* ===== 타이틀 ===== */
  .title-screen{
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    background:linear-gradient(to bottom,rgba(0,0,0,0.25),rgba(0,0,0,0.85));
    color:#ffffff;
    text-align:center;
    padding:20px;
    z-index:10;
  }
  .title-lines{
    font-family:monospace;
    font-size:clamp(18px,3.4vmin,28px);
    letter-spacing:0.08em;
    line-height:1.7;
    text-shadow:0 3px 0 rgba(0,0,0,0.9);
    margin-bottom:28px;
  }
  .title-lines span{
    display:block;
  }
  .btn{
    display:inline-block;
    padding:10px 30px;
    border-radius:999px;
    border:3px solid #111;
    background:#f3c86c;
    color:#111;
    font-weight:600;
    font-size:16px;
    box-shadow:0 4px 0 #111;
    cursor:pointer;
  }
  .btn:active{
    transform:translateY(2px);
    box-shadow:0 2px 0 #111;
  }

  /* ===== 대화 상자 (타자 효과) ===== */
  .dialog-layer{
    position:absolute;
    left:50%;
    bottom:6%;
    transform:translateX(-50%);
    width:90%;
    max-width:640px;
    padding:12px 16px;
    background:rgba(15,16,20,0.97);
    border:3px solid #ffffff;
    box-shadow:0 4px 0 rgba(0,0,0,0.8);
    border-radius:10px;
    display:none;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    color:#f5f5f5;
    font-size:15px;
    font-family:monospace;
  }
  .dialog-text{
    flex:1;
    text-align:left;
    min-height:1.4em;
    white-space:pre-wrap;
  }
  .dialog-btn{
    flex-shrink:0;
    padding:6px 12px;
    border-radius:8px;
    border:2px solid #fff;
    background:#f0ad4b;
    color:#111;
    font-size:13px;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 3px 0 rgba(0,0,0,0.8);
    white-space:nowrap;
  }
  .dialog-btn:active{
    transform:translateY(1px);
    box-shadow:0 1px 0 rgba(0,0,0,0.8);
  }
</style>
</head>
<body>

<div class="rotate-warning">
  이 게임은 <strong>가로 모드</strong>에서만 사용할 수 있습니다.<br><br>
  기기를 가로로 돌려 주세요.
</div>

<div class="game-shell">
  <div class="game-popup">
    <div class="game-root">
      <div class="sky"></div>

      <div class="city">
        <div class="city-layer city-far"></div>
        <div class="city-layer city-mid"></div>
        <div class="city-layer city-near"></div>
      </div>

      <div class="bush-band"></div>

      <div class="road">
        <div class="road-edge-top"></div>
        <div class="road-edge-bottom"></div>

        <div class="lane mid"></div>
        <div class="lane low"></div>

        <div class="lamps">
          <div class="lamp" style="left:7%;"></div>
          <div class="lamp" style="left:22%;"></div>
          <div class="lamp" style="left:37%;"></div>
          <div class="lamp" style="left:52%;"></div>
          <div class="lamp" style="left:67%;"></div>
          <div class="lamp" style="left:82%;"></div>
        </div>

        <div class="car" style="--scale:1;"></div>
        <div class="car front" style="--scale:0.9;"></div>
      </div>

      <!-- 타이틀 -->
      <div class="title-screen" id="title">
        <div class="title-lines">
          <span>SLEEEEEEEEEEP</span>
          <span>SLEEEEEEEEEEP</span>
          <span>SLEEEEEEEEEEP</span>
          <span>SLEEEEEEEEEEP</span>
        </div>
        <button class="btn" id="startBtn">Start</button>
      </div>

      <!-- 대화 상자 -->
      <div class="dialog-layer" id="dialog">
        <div class="dialog-text" id="dialogText"></div>
        <button class="dialog-btn" id="dialogNext">NEXT</button>
      </div>

      <!-- 도시 앰비언스 BGM (src를 실제 파일로 교체) -->
      <audio id="bgm" src="city-ambience.mp3" loop></audio>
    </div>
  </div>
</div>

<script>
  const titleEl  = document.getElementById('title');
  const startBtn = document.getElementById('startBtn');

  const dialogLayer = document.getElementById('dialog');
  const dialogText  = document.getElementById('dialogText');
  const dialogNext  = document.getElementById('dialogNext');

  const bgm = document.getElementById('bgm');

  const lines = [
    '안녕?',
    '여행은 어때?',
    '너는 곧 3번째 수면 단계로 진입할 거야.',
    '우선 어디 편한 곳에 자리를 잡고 앉아봐.'
  ];
  let idx = 0;
  let typing = false;

  function typeLine(text){
    dialogText.textContent = '';
    typing = true;
    dialogNext.disabled = true;
    dialogNext.style.opacity = 0.5;

    let i = 0;
    const speed = 55; // ms per char

    const timer = setInterval(()=>{
      dialogText.textContent += text[i];
      i++;
      if(i >= text.length){
        clearInterval(timer);
        typing = false;
        dialogNext.disabled = false;
        dialogNext.style.opacity = 1;

        // 마지막 문장이면 버튼 문구 바꾸기
        if(idx === lines.length - 1){
          dialogNext.textContent = 'OK';
        }else{
          dialogNext.textContent = 'NEXT';
        }
      }
    }, speed);
  }

  function showLine(i){
    dialogLayer.style.display = 'flex';
    typeLine(lines[i]);
  }

  startBtn.addEventListener('click', () => {
    titleEl.style.display = 'none';
    idx = 0;
    showLine(idx);

    // 첫 상호작용에서 BGM 재생 (브라우저 자동재생 정책 대응)
    if(bgm && bgm.paused){
      bgm.volume = 0.7;
      bgm.play().catch(()=>{ /* 무시 */ });
    }
  });

  dialogNext.addEventListener('click', () => {
    if(typing) return; // 타이핑 중에는 스킵 방지
    idx++;
    if(idx < lines.length){
      showLine(idx);
    }else{
      // 마지막 이후에는 버튼만 비활성화
      dialogNext.disabled = true;
      dialogNext.style.opacity = 0.5;
    }
  });
</script>

</body>
</html>