<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>Grave Run — Entrance</title>

<meta name="theme-color" content="#140c1c" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Grave Run" />

<style>
  :root{
    --bg:#0a0812; --fg:#eae6ff; --muted:#b9b4d6; --accent:#ff7a33;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bot: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:ui-monospace,"SF Mono",Menlo,Consolas,monospace;}
  #wrap{
    min-height:100svh; display:grid; place-items:center;
    padding:calc(16px + var(--safe-top)) calc(16px + var(--safe-right))
            calc(16px + var(--safe-bot)) calc(16px + var(--safe-left));
  }
  .card{
    width:min(720px,92vw);
    background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.14);
    border-radius:16px;
    box-shadow:0 12px 32px rgba(0,0,0,.45);
    padding:20px;
  }
  h1{margin:0 0 6px; font-size:20px; letter-spacing:.3px}
  .sub{opacity:.8; font-size:12px; margin-bottom:16px}
  .row{display:grid; grid-template-columns:140px 1fr; gap:10px; align-items:center; margin:12px 0}
  .row label{font-weight:700; font-size:12px; color:var(--muted)}
  input,select{
    width:100%; padding:10px 12px; border-radius:12px;
    border:1px solid rgba(255,255,255,.16);
    background:rgba(255,255,255,.06); color:#fff; font:600 13px ui-monospace,monospace;
  }
  .hint{font-size:11px; opacity:.7; margin-top:6px}
  .panel{
    margin-top:12px;
    background:rgba(0,0,0,.35);
    border:1px solid rgba(255,255,255,.15);
    border-radius:12px;
    padding:12px; font-size:12px; line-height:1.6;
  }
  .controls{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
  .btn{
    padding:12px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.22);
    background:rgba(255,255,255,.08); color:#fff; font:800 13px ui-monospace,monospace;
    letter-spacing:.3px; cursor:pointer; user-select:none;
  }
  .btn.primary{background:linear-gradient(180deg,#ff7a33,#b74f14); border-color:rgba(0,0,0,.35)}
  .btn:active{transform:translateY(1px)}
  .footer{display:flex; justify-content:space-between; align-items:center; margin-top:16px; font-size:11px; opacity:.75}
  .kbd{padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.2); opacity:.9}
</style>
</head>
<body>
<div id="wrap">
  <div class="card" role="dialog" aria-modal="true">
    <h1>Grave Run — 접속</h1>
    <div class="sub">비석의 방 → 전화기의 방. 터치 D-Pad 또는 키보드(↑↓←→ / WASD)로 이동.</div>

    <div class="row">
      <label for="player">플레이어 이름</label>
      <div>
        <input id="player" placeholder="예: guest" maxlength="16" />
        <div class="hint">선택 사항. 대화/로그에 이름이 표기됩니다.</div>
      </div>
    </div>

    <div class="row">
      <label for="target">게임 페이지 파일</label>
      <div>
        <input id="target" value="game.html" />
        <div class="hint">제공된 게임 파일명 (예: <b>game.html</b> / <b>grave-run.html</b>)</div>
      </div>
    </div>

    <div class="row">
      <label for="room">시작 위치</label>
      <select id="room">
        <option value="0" selected>비석의 방</option>
        <option value="1">전화기의 방</option>
      </select>
    </div>

    <div class="row">
      <label for="sfx">사운드</label>
      <select id="sfx">
        <option value="1" selected>켜기</option>
        <option value="0">끄기</option>
      </select>
    </div>

    <div class="panel" aria-live="polite">
      <b>조작</b>
      <ul style="margin:8px 0 0 18px;padding:0">
        <li>모바일: 화면 좌하단 D-패드(상·하·좌·우)</li>
        <li>데스크톱: <b>WASD/화살표</b>, 상호작용 <b>E</b></li>
      </ul>
      <div style="opacity:.8;margin-top:10px">시작을 누르면 전체화면 및 오디오가 활성화됩니다.</div>
    </div>

    <div class="controls">
      <button class="btn" id="btnHow">세계관 요약</button>
      <button class="btn" id="btnFs">전체화면 테스트</button>
      <button class="btn primary" id="btnStart">시작하기</button>
    </div>

    <div class="footer">
      <span>키보드: <span class="kbd">WASD</span>/<span class="kbd">↑↓←→</span>, 상호작용: <span class="kbd">E</span></span>
      <span>권장: 세로 화면 · 터치 허용 필요</span>
    </div>
  </div>
</div>

<script>
/* ===== Minimal PWA manifest (runtime attach) ===== */
(function(){
  const manifest={
    name:"Grave Run",
    short_name:"GraveRun",
    start_url:".",
    display:"standalone",
    background_color:"#140c1c",
    theme_color:"#140c1c"
  };
  const mURL=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:'application/json'}));
  const link=document.createElement('link'); link.rel='manifest'; link.href=mURL; document.head.appendChild(link);
})();

/* ===== 8bit SFX ===== */
let AC, gainNode, audioReady=false;
function initAudio(){
  if(audioReady) return;
  AC=new (window.AudioContext||window.webkitAudioContext)();
  gainNode=AC.createGain(); gainNode.gain.value=0.22; gainNode.connect(AC.destination);
  audioReady=true;
}
async function unlockAudio(){
  try{ initAudio(); if(AC.state==='suspended') await AC.resume(); }catch(e){}
}
['pointerdown','touchstart','keydown'].forEach(ev=>addEventListener(ev,unlockAudio,{passive:true}));

function beep(freq=660, dur=0.08, vol=0.28){
  if(!audioReady) return;
  const t=AC.currentTime, o=AC.createOscillator(), g=AC.createGain();
  o.type='square'; o.frequency.setValueAtTime(freq,t);
  g.gain.setValueAtTime(0,t);
  g.gain.linearRampToValueAtTime(vol,t+0.01);
  g.gain.linearRampToValueAtTime(0.0001,t+dur+0.06);
  o.connect(g); g.connect(gainNode); o.start(t); o.stop(t+dur+0.06);
}
const SFX={ click(){beep(600,0.06,0.24);}, confirm(){beep(760,0.08,0.26);} };

/* ===== Helpers ===== */
function isAndroid(){ return /Android/i.test(navigator.userAgent); }
async function goFullscreen(){
  const el=document.documentElement;
  if(el.requestFullscreen){ try{ await el.requestFullscreen(); }catch(e){} }
}

/* ===== Start flow ===== */
function startGame(){
  const target=(document.getElementById('target').value||'game.html').trim();
  const player=(document.getElementById('player').value||'').trim();
  const room=document.getElementById('room').value;
  const sfx=document.getElementById('sfx').value;

  if(sfx==='1') SFX.confirm();
  if(isAndroid()) goFullscreen();

  const params=new URLSearchParams();
  if(player) params.set('player',player);
  params.set('room',room);
  params.set('sfx',sfx);

  const url=target + (target.includes('?')?'&':'?') + params.toString();
  location.href=url;
}

/* ===== Bindings ===== */
document.getElementById('btnStart').addEventListener('click', startGame);
document.getElementById('btnFs').addEventListener('click', async ()=>{ SFX.click(); await goFullscreen(); alert('전체화면을 시도했습니다. 일부 브라우저는 사용자 상호작용 후에만 허용합니다.'); });
document.getElementById('btnHow').addEventListener('click', ()=>{ SFX.click(); alert("비석의 방에서 로봇과 대화하고 비석/전화기에 귀 기울이세요.\n하단 통로로 방을 드나들 수 있습니다."); });

// Enter 키로 시작
addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); startGame(); }});
</script>
</body>
</html>
